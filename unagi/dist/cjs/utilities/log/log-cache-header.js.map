{
  "version": 3,
  "sources": ["../../../../src/utilities/log/log-cache-header.ts"],
  "sourcesContent": ["import { gray } from 'kolorist'\n\nimport { UnagiRequest } from '../../foundation/UnagiRequest/UnagiRequest.server.js'\nimport { UnagiResponse } from '../../foundation/UnagiResponse/UnagiResponse.server.js'\nimport { QueryKey } from '../../types.js'\nimport { hashKey } from '../hash.js'\nimport { RenderType, getLoggerWithContext } from './log.js'\nimport { findQueryName, parseUrl } from './utils.js'\n\nconst color = gray\n\nexport type QueryCacheControlHeaders = {\n  name: string\n  header: string | null\n}\n\nexport function collectQueryCacheControlHeaders(\n  request: UnagiRequest,\n  queryKey: QueryKey,\n  cacheControlHeader: string | null\n) {\n  request.ctx.queryCacheControl.push({\n    name: findQueryName(hashKey(queryKey)),\n    header: cacheControlHeader,\n  })\n}\n\nexport function logCacheControlHeaders(\n  type: RenderType,\n  request: UnagiRequest,\n  response?: UnagiResponse\n) {\n  const log = getLoggerWithContext(request)\n  if (!log.options().showCacheControlHeader) {\n    return\n  }\n\n  log.debug(color(`\u250C\u2500\u2500 Cache control header for ${parseUrl(type, request.url)}`))\n  if (response) {\n    log.debug(color(`\u2502 ${response.cacheControlHeader}`))\n  }\n\n  const queryList = request.ctx.queryCacheControl\n  const longestQueryNameLength = queryList.reduce(\n    (max: number, query: QueryCacheControlHeaders) => Math.max(max, query.name.length),\n    0\n  )\n\n  if (queryList.length > 0) {\n    log.debug(color('\u2502'))\n    queryList.forEach((query: QueryCacheControlHeaders) => {\n      log.debug(color(`\u2502 query ${query.name.padEnd(longestQueryNameLength + 1)}${query.header}`))\n    })\n  }\n\n  log.debug(color('\u2514\u2500\u2500'))\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAqB;AAKrB,kBAAwB;AACxB,iBAAiD;AACjD,mBAAwC;AAExC,MAAM,QAAQ;AAOP,yCACL,SACA,UACA,oBACA;AACA,UAAQ,IAAI,kBAAkB,KAAK;AAAA,IACjC,MAAM,gCAAc,yBAAQ,QAAQ,CAAC;AAAA,IACrC,QAAQ;AAAA,EACV,CAAC;AACH;AAEO,gCACL,MACA,SACA,UACA;AACA,QAAM,MAAM,qCAAqB,OAAO;AACxC,MAAI,CAAC,IAAI,QAAQ,EAAE,wBAAwB;AACzC;AAAA,EACF;AAEA,MAAI,MAAM,MAAM,+CAAgC,2BAAS,MAAM,QAAQ,GAAG,GAAG,CAAC;AAC9E,MAAI,UAAU;AACZ,QAAI,MAAM,MAAM,UAAK,SAAS,oBAAoB,CAAC;AAAA,EACrD;AAEA,QAAM,YAAY,QAAQ,IAAI;AAC9B,QAAM,yBAAyB,UAAU,OACvC,CAAC,KAAa,UAAoC,KAAK,IAAI,KAAK,MAAM,KAAK,MAAM,GACjF,CACF;AAEA,MAAI,UAAU,SAAS,GAAG;AACxB,QAAI,MAAM,MAAM,QAAG,CAAC;AACpB,cAAU,QAAQ,CAAC,UAAoC;AACrD,UAAI,MAAM,MAAM,gBAAW,MAAM,KAAK,OAAO,yBAAyB,CAAC,IAAI,MAAM,QAAQ,CAAC;AAAA,IAC5F,CAAC;AAAA,EACH;AAEA,MAAI,MAAM,MAAM,oBAAK,CAAC;AACxB;",
  "names": []
}
