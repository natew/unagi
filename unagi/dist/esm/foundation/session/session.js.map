{
  "version": 3,
  "sources": ["../../../../src/foundation/session/session.ts"],
  "sourcesContent": ["import { Logger } from '../../utilities/log/index.js'\nimport { wrapPromise } from '../../utilities/suspense.js'\nimport type { UnagiRequest } from '../UnagiRequest/UnagiRequest.server.js'\nimport type { UnagiResponse } from '../UnagiResponse/UnagiResponse.server.js'\nimport type { SessionStorageAdapter } from './session-types.js'\n\nexport function getSyncSessionApi(\n  request: UnagiRequest,\n  componentResponse: UnagiResponse,\n  log: Logger,\n  session?: SessionStorageAdapter\n) {\n  type ThrowablePromise = {\n    read: () => any\n  }\n\n  const sessionPromises: { [key: string]: ThrowablePromise } = {}\n\n  return session\n    ? {\n        get() {\n          if (!sessionPromises.getPromise) {\n            sessionPromises.getPromise = wrapPromise(session.get(request))\n          }\n          return sessionPromises.getPromise.read()\n        },\n      }\n    : emptySyncSessionImplementation(log)\n}\n\nexport const emptySessionImplementation = function (log: Logger) {\n  return {\n    async get() {\n      log.warn('No session adapter has been configured!')\n      return {}\n    },\n    async set(key: string, value: string) {\n      log.warn('No session adapter has been configured!')\n    },\n    async destroy() {\n      log.warn('No session adapter has been configured!')\n      return\n    },\n  }\n}\n\nexport const emptySyncSessionImplementation = function (log: Logger) {\n  return {\n    get() {\n      log.warn('No session adapter has been configured!')\n      return {}\n    },\n  }\n}\n"],
  "mappings": "AACA;AAKO,2BACL,SACA,mBACA,KACA,SACA;AAKA,QAAM,kBAAuD,CAAC;AAE9D,SAAO,UACH;AAAA,IACE,MAAM;AACJ,UAAI,CAAC,gBAAgB,YAAY;AAC/B,wBAAgB,aAAa,YAAY,QAAQ,IAAI,OAAO,CAAC;AAAA,MAC/D;AACA,aAAO,gBAAgB,WAAW,KAAK;AAAA,IACzC;AAAA,EACF,IACA,+BAA+B,GAAG;AACxC;AAEO,MAAM,6BAA6B,SAAU,KAAa;AAC/D,SAAO;AAAA,IACL,MAAM,MAAM;AACV,UAAI,KAAK,yCAAyC;AAClD,aAAO,CAAC;AAAA,IACV;AAAA,IACA,MAAM,IAAI,KAAa,OAAe;AACpC,UAAI,KAAK,yCAAyC;AAAA,IACpD;AAAA,IACA,MAAM,UAAU;AACd,UAAI,KAAK,yCAAyC;AAClD;AAAA,IACF;AAAA,EACF;AACF;AAEO,MAAM,iCAAiC,SAAU,KAAa;AACnE,SAAO;AAAA,IACL,MAAM;AACJ,UAAI,KAAK,yCAAyC;AAClD,aAAO,CAAC;AAAA,IACV;AAAA,EACF;AACF;",
  "names": []
}
